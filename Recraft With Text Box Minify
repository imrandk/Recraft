const box=document.createElement("div");Object.assign(box.style,{position:"absolute",width:"300px",height:"200px",backgroundColor:"white",border:"2px solid #ccc",boxShadow:"0 4px 8px rgba(0,0,0,0.1)",top:"50px",left:"50px",resize:"both",overflow:"auto"});const header=document.createElement("div");Object.assign(header.style,{width:"100%",height:"30px",backgroundColor:"#007bff",color:"white",textAlign:"center",lineHeight:"30px",cursor:"move"}),header.textContent="Drag Me",box.appendChild(header);const ta=document.createElement("textarea");ta.id="promptBoxTextarea",Object.assign(ta.style,{width:"100%",height:"calc(100% - 30px)",border:"none",outline:"none",resize:"none",padding:"10px",fontSize:"16px"}),ta.placeholder="Enter prompts in format:\nPrompt: Your prompt text",box.appendChild(ta),document.body.appendChild(box);let offsetX,offsetY,isDragging=!1;header.addEventListener("mousedown",(e=>{isDragging=!0;const t=box.getBoundingClientRect();offsetX=e.clientX-t.left,offsetY=e.clientY-t.top})),document.addEventListener("mousemove",(e=>{isDragging&&(box.style.left=e.clientX-offsetX+"px",box.style.top=e.clientY-offsetY+"px")})),document.addEventListener("mouseup",(()=>isDragging=!1)),(()=>{const e=/Prompt:\s*(.+?)(?=\n|$)/g;let t=[];const a=()=>new Promise((e=>{const a=document.getElementById("promptBoxTextarea");if(t.length&&a){const n=t.shift(),c=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),i=new RegExp(`^\\s*Prompt:\\s*${c}\\s*(?:\\r?\\n)?`,"m");a.value=a.value.replace(i,"");const s=document.querySelector('textarea[data-testid="recraft-textarea"]');s?(s.focus(),o=s,r=n,Object.getOwnPropertyDescriptor(HTMLTextAreaElement.prototype,"value").set.call(o,r),o.dispatchEvent(new Event("input",{bubbles:!0})),s.dispatchEvent(new Event("change",{bubbles:!0})),setTimeout((()=>e(n)),100)):e(null)}else e(null);var o,r})),o=(e,t=500,a=20)=>new Promise((o=>{let r=0;const n=setInterval((()=>{const t=document.querySelector('textarea[data-testid="recraft-textarea"]');t&&t.value===e?(clearInterval(n),o(!0)):r++>=a&&(clearInterval(n),o(!1))}),t)})),r=e=>new Promise((t=>setTimeout(t,e))),n=e=>{const t=document.querySelector(e);return t&&t.click(),Promise.resolve()},c=async(e,t=5e3)=>{const a=Date.now();for(;Date.now()-a<t;){const t=document.querySelectorAll(e);for(const e of t)if("SVG"===e.textContent.trim())return e.click(),Promise.resolve();await r(100)}return Promise.resolve()},i=(e=1e3,t=30)=>new Promise((a=>{let o=0;const r=setInterval((async()=>{if(o++>=t)return clearInterval(r),void a(!1);await Promise.resolve("Recraft"===document.querySelector('button[data-testid="recraft-button"]')?.textContent.trim())&&(clearInterval(r),a(!0))}),e)})),s=()=>{const s=document.getElementById("promptBoxTextarea");if(!s)return!1;const l=[...s.value.matchAll(e)];return t=l.map((e=>e[1])),!!t.length&&((async()=>{for(;t.length&&"Cancel"!==document.querySelector("button.c-bZNrxE.c-cfmRqm.c-cfmRqm-djDtlJ-stretch-false.c-cfmRqm-hdlaDN-size-m.c-cfmRqm-vSIUM-mode-secondary")?.textContent.trim();){await r(2e3);const e=await a();if(!e)break;if(!await o(e))continue;await n('button[data-testid="recraft-button"]');let t=!1;for(let e=0;e<5;e++){if(document.querySelector("div.c-kWXNTX.c-kWXNTX-ijbiex-visible-true")?.textContent.includes("Sorry, we canâ€™t recraft as fast as you click")){t=!0;break}await r(2e3)}t||(await r(1e3),await i(),await r(1e3),await n('[data-testid="recraft-topbar-export"] > [data-testid="toggler"]'),await r(1e3),await c("button.c-bZNrxE.c-cfmRqm.c-cfmRqm-fGHEql-stretch-true.c-cfmRqm-kumaHe-size-s.c-cfmRqm-ffVEBR-mode-primary.c-nSdQa"),await r(1e3),await n("button.c-xHEva:nth-child(2)"),await r(1e3),await n('[data-testid="recraft-topbar-export"] > [data-testid="toggler"]'),await r(1e3),await c("button.c-bZNrxE.c-cfmRqm.c-cfmRqm-fGHEql-stretch-true.c-cfmRqm-kumaHe-size-s.c-cfmRqm-ffVEBR-mode-primary.c-nSdQa"))}})(),!0)};if(!s()){const e=setInterval((()=>{s()&&clearInterval(e)}),5e3)}})();
